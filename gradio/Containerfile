# Use Red Hat Universal Base Image for security compliance
FROM registry.access.redhat.com/ubi9/python-311:latest

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    GRADIO_SERVER_NAME="0.0.0.0" \
    GRADIO_SERVER_PORT=8080

# Install dependencies
COPY --chown=1001:0 requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY --chown=1001:0 app.py .

# OpenShift security: Run as a non-privileged user (UID 1001)
# The UBI python image defaults to 1001, but we explicitely set it for clarity
USER 1001

# Expose the non-privileged port
EXPOSE 8080

CMD ["python", "app.py"]